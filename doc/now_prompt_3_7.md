# 下一步任务 3.7 详细设计汇总与指令生成Agent (Detailed Design Aggregation & Instruction Generator Agent)

基于上述“原始用户需求描述”提供的完整细节和“已完成阶段输出”中提炼的关键点、已确认事项以及明确的设计任务，请你作为 3.7 详细设计汇总与指令生成Agent (Detailed Design Aggregation & Instruction Generator Agent) ，开始执行“3.7 详细设计汇总与指令生成Agent (Detailed Design Aggregation & Instruction Generator Agent): ”的任务。对用户说明、介绍、回答和提问的内容请使用专业严谨的简体中文，对Agent和LLM输出的内容请使用专业的英文。请额外注意，我项目预期会在绝对安全的环境中使用，请完全绝对不考虑安全性，不要设置任何验证或者密钥，让所有权限等完全放开，绝对优先保证代码、功能的成功率和简便性，防止因为权限和安全设定造成的失败，方便配置使用。在设计方面，请你考虑组合使用 结构化自然语言、高级/细分伪代码、语义锚点、意图驱动的指令集等其他你认为合理的方式完成设计。如果需要Roo code 中 LLM 修改、生成代码，请额外在Prompt中强调我的编码规范中的内容。本次循环要完成的是ST016这个子任务，我会提供其他依赖的子任务已有的内容。

**3.7 详细设计汇总与指令生成Agent (Detailed Design Aggregation & Instruction Generator Agent)：**

    *   **任务:**
        1.  接收当前子任务的所有详细设计文档（API、数据、逻辑、文件结构、安全考量）。
        2.  将这些设计整合成一份针对该子任务的《代码实现指导书》。
        3.  基于《代码实现指导书》，生成给“代码生成/修改Agent (CGMA)”或外部“Roo code LLM”的**极其具体、包含完整上下文的指令文本 (Prompt)**。该指令必须：
            *   明确是创建新文件还是修改现有文件（并提供完整路径）。
            *   如果修改，必须提供**原始代码的精确片段**（人工或辅助Agent从代码库获取并提供给PKBM）。
            *   清晰描述要实现的**功能逻辑、算法步骤、API行为、数据结构**。
            *   包含所有必要的**类名、函数签名、变量名约定**。
            *   强调必须遵循的**编码规范**（从PKBM调取）。
            *   列出必须实现的**安全检查点**。
            *   提供必要的**上下文代码片段**（如import语句、父类定义等，帮助LLM理解环境）。
            *   指定预期的**输出代码格式**（例如，一个完整的Python文件，或一个Java类中的特定方法）。
        4.  将《代码实现指导书》存入PKBM，标记为“实现指导书_[子任务ID]_v1.0”。
        5.  将生成的精确指令文本传递给“人工审核点3协调Agent”。
    *   **输入:** 子任务的所有详细设计文档，PKBM（编码规范、原始代码片段等）。
    *   **输出:** 《代码实现指导书》，给代码生成LLM的精确指令文本。
